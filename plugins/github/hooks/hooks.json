{
  "hooks": [
    {
      "name": "validate-github-actions-workflows",
      "event": "pre-commit",
      "description": "Validates GitHub Actions workflow YAML syntax and common errors before committing",
      "match": {
        "files": [
          ".github/workflows/*.yml",
          ".github/workflows/*.yaml"
        ]
      },
      "steps": [
        {
          "name": "yaml-syntax-check",
          "command": "python3 -c \"import yaml, sys; yaml.safe_load(open(sys.argv[1]))\" ${file}",
          "description": "Verify the file is valid YAML",
          "onFailure": "block"
        },
        {
          "name": "actionlint-check",
          "command": "actionlint ${file}",
          "description": "Run actionlint to check for GitHub Actions-specific errors",
          "onFailure": "warn",
          "condition": "command -v actionlint &> /dev/null"
        },
        {
          "name": "check-pinned-actions",
          "command": "grep -n 'uses:' ${file} | grep -v '@[a-f0-9]\\{40\\}' | grep -v 'uses: ./' | head -20",
          "description": "Warn about actions not pinned to a full SHA",
          "onFailure": "warn"
        },
        {
          "name": "check-permissions",
          "command": "grep -q 'permissions:' ${file}",
          "description": "Verify that the workflow declares explicit permissions",
          "onFailure": "warn"
        }
      ]
    },
    {
      "name": "format-workflow-yaml",
      "event": "post-save",
      "description": "Auto-formats GitHub Actions workflow YAML files on save for consistent style",
      "match": {
        "files": [
          ".github/workflows/*.yml",
          ".github/workflows/*.yaml"
        ]
      },
      "steps": [
        {
          "name": "prettier-yaml",
          "command": "npx prettier --write --parser yaml ${file}",
          "description": "Format YAML with Prettier for consistent indentation and quoting",
          "onFailure": "ignore",
          "condition": "command -v npx &> /dev/null"
        }
      ]
    }
  ]
}
